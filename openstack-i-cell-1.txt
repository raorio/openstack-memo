
TODO
	課題
		parent側にnova-network構築
	問題
		

refer
	openstack install manual
		http://docs.openstack.org/icehouse/install-guide/install/yum/content/
		http://docs.openstack.org/icehouse/config-reference/content/section_compute-cells.html
		http://docs.openstack.org/user-guide/content/novaclient_commands.html
		https://wiki.openstack.org/wiki/Blueprint-nova-compute-cells

etc
	icehouse\nova-cells\
		parent-1
		child-1-1
		child-1-2

構築
	icehouse
		parent-1
			os: centos 6.5 x86_64
			cpu: 2
			memory: 4 GB
			disk: 40 GB
			3nic:
				eth0: 192.168.116.61(nat)
				eth1: 192.168.10.61(bridge)
				eth2: 192.168.238.61(host only)
			install: dvd1
				root password: user1
				user: user1
				user password: user1
			setup:
				login root
				必要があればproxy設定
					vi /etc/yum.conf
						http_proxy=
				vi /etc/hosts
					#192.168.116.61 openstack-i-cell-parent-1
					192.168.10.61 openstack-i-cell-parent-1
					#192.168.238.61 openstack-i-cell-parent-1
					192.168.10.62 openstack-i-cell-child-1-1
					192.168.10.63 openstack-i-cell-child-1-2
				vi /etc/sysconfig/network
					NETWORKING=yes
					#HOSTNAME=localhost.localdomain
					HOSTNAME=openstack-i-cell-parent-1
				vi /etc/sysconfig/network-scripts/ifcfg-eth0
					DEVICE="eth0"
					#BOOTPROTO="dhcp"
					BOOTPROTO="static"
					HWADDR="00:0C:29:BC:06:E5"
					IPV6INIT="yes"
					NM_CONTROLLED="yes"
					ONBOOT="yes"
					TYPE="Ethernet"
					UUID="7fce2f22-528c-4915-901e-4f90f014ecc4"
					IPADDR=192.168.116.61
					PREFIX=24
				vi /etc/sysconfig/network-scripts/ifcfg-eth1
					EVICE=eth1
					HWADDR=00:0C:29:BC:06:EF
					TYPE=Ethernet
					UUID=f4907d33-7c50-4cd0-90ca-e0a83d551a40
					ONBOOT=yes
					NM_CONTROLLED=yes
					#BOOTPROTO=dhcp
					BOOTPROTO=static
					IPADDR=192.168.10.61
					PREFIX=24
					GATEWAY=192.168.10.1
					DNS1=192.168.10.1
				vi /etc/sysconfig/network-scripts/ifcfg-eth2
					DEVICE=eth2
					HWADDR=00:0C:29:BC:06:F9
					TYPE=Ethernet
					UUID=ce1967ce-a970-4ce1-98d4-acd8cf617829
					ONBOOT=yes
					#NM_CONTROLLED=yes
					#BOOTPROTO=dhcp
					BOOTPROTO=static
					IPADDR=192.168.238.61
					PREFIX=24
				
				setenforce 0
				getenforce
				vi /etc/selinux/config
					SELINUX=premissive
				
				GUIでfirewallを解除
				
				reboot
				
				バックアップ作成：20140625_os_installed
				
				service NetworkManager stop
				service network start
				chkconfig NetworkManager off
				chkconfig network on
				
				yum -y install ntp
				service ntpd start
				chkconfig ntpd on
				
				yum -y install mysql mysql-server MySQL-python
				vi /etc/my.cnf
					bind-address = 0.0.0.0
					default-storage-engine = innodb
					innodb_file_per_table
					collation-server = utf8_general_ci
					init-connect = 'SET NAMES utf8'
					character-set-server = utf8
				service mysqld start
				chkconfig mysqld on
				mysql_install_db
				mysql_secure_installation
					user1
				
				yum -y install yum-plugin-priorities
				yum -y install http://repos.fedorapeople.org/repos/openstack/openstack-icehouse/rdo-release-icehouse-3.noarch.rpm
				yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
				yum -y install openstack-utils
				yum -y install openstack-selinux
				yum -y upgrade
				reboot
				
				yum -y install qpid-cpp-server
				vi /etc/qpidd.conf
					auth=no
				service qpidd start
				chkconfig qpidd on
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/ch_keystone.html
				yum -y install openstack-keystone python-keystoneclient
				
				openstack-config --set /etc/keystone/keystone.conf database connection mysql://keystone:KEYSTONE_DBPASS@openstack-i-cell-parent-1/keystone
				
				mysql -u root -puser1
					CREATE DATABASE keystone;
					GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'KEYSTONE_DBPASS';
					GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'KEYSTONE_DBPASS';
					exit
				
				su -s /bin/sh -c "keystone-manage db_sync" keystone
				
				#ADMIN_TOKEN=$(openssl rand -hex 10)
				#echo $ADMIN_TOKEN
				#openstack-config --set /etc/keystone/keystone.conf DEFAULT admin_token $ADMIN_TOKEN
				openstack-config --set /etc/keystone/keystone.conf DEFAULT admin_token ADMIN_TOKEN
				
				keystone-manage pki_setup --keystone-user keystone --keystone-group keystone
				chown -R keystone:keystone /etc/keystone/ssl
				chmod -R o-rwx /etc/keystone/ssl
				
				service openstack-keystone start
				chkconfig openstack-keystone on
				
				(crontab -l -u keystone 2>&1 | grep -q token_flush) || echo '@hourly /usr/bin/keystone-manage token_flush >/var/log/keystone/keystone-tokenflush.log 2>&1' >> /var/spool/cron/keystone
				
				export OS_SERVICE_TOKEN=ADMIN_TOKEN
				export OS_SERVICE_ENDPOINT=http://openstack-i-cell-parent-1:35357/v2.0
				
				keystone user-create --name=admin --pass=ADMIN_PASS --email=ADMIN_EMAIL
				keystone role-create --name=admin
				keystone tenant-create --name=admin --description="Admin Tenant"
				keystone user-role-add --user=admin --tenant=admin --role=admin
				keystone user-role-add --user=admin --role=_member_ --tenant=admin
				
				keystone user-create --name=demo --pass=DEMO_PASS --email=DEMO_EMAIL
				keystone tenant-create --name=demo --description="Demo Tenant"
				keystone user-role-add --user=demo --role=_member_ --tenant=demo
				
				keystone tenant-create --name=service --description="Service Tenant"
				
				keystone service-create --name=keystone --type=identity --description="OpenStack Identity"
				
				keystone endpoint-create --service-id=$(keystone service-list | awk '/ identity / {print $2}') --publicurl=http://openstack-i-cell-parent-1:5000/v2.0 --internalurl=http://openstack-i-cell-parent-1:5000/v2.0 --adminurl=http://openstack-i-cell-parent-1:35357/v2.0
				
				unset OS_SERVICE_TOKEN OS_SERVICE_ENDPOINT
				
				keystone --os-username=admin --os-password=ADMIN_PASS --os-auth-url=http://openstack-i-cell-parent-1:35357/v2.0 token-get
				keystone --os-username=admin --os-password=ADMIN_PASS --os-tenant-name=admin --os-auth-url=http://openstack-i-cell-parent-1:35357/v2.0 token-get
				
				vi admin-openrc.sh
					export OS_USERNAME=admin
					export OS_PASSWORD=ADMIN_PASS
					export OS_TENANT_NAME=admin
					export OS_AUTH_URL=http://openstack-i-cell-parent-1:35357/v2.0
				
				source admin-openrc.sh
				
				keystone token-get
				
				keystone user-list
				
				keystone user-role-list --user admin --tenant admin
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/ch_clients.html
				allmost skip
				
				vi demo-openrc.sh
					export OS_USERNAME=demo
					export OS_PASSWORD=DEMO_PASS
					export OS_TENANT_NAME=demo
					export OS_AUTH_URL=http://openstack-i-cell-parent-1:35357/v2.0
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/ch_glance.html
				yum -y install openstack-glance python-glanceclient
				
				openstack-config --set /etc/glance/glance-api.conf database connection mysql://glance:GLANCE_DBPASS@openstack-i-cell-parent-1/glance
				openstack-config --set /etc/glance/glance-registry.conf database connection mysql://glance:GLANCE_DBPASS@openstack-i-cell-parent-1/glance
				
				openstack-config --set /etc/glance/glance-api.conf DEFAULT rpc_backend qpid
				openstack-config --set /etc/glance/glance-api.conf DEFAULT qpid_hostname openstack-i-cell-parent-1
				
				mysql -u root -puser1
					CREATE DATABASE glance;
					GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED BY 'GLANCE_DBPASS';
					GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY 'GLANCE_DBPASS';
					exit;
				
				su -s /bin/sh -c "glance-manage db_sync" glance
				
				keystone user-create --name=glance --pass=GLANCE_PASS --email=glance@example.com
				keystone user-role-add --user=glance --tenant=service --role=admin
				
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_host openstack-i-cell-parent-1
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_port 35357
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken auth_protocol http
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken admin_tenant_name service
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken admin_user glance
				openstack-config --set /etc/glance/glance-api.conf keystone_authtoken admin_password GLANCE_PASS
				openstack-config --set /etc/glance/glance-api.conf paste_deploy flavor keystone
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_host openstack-i-cell-parent-1
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_port 35357
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken auth_protocol http
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken admin_tenant_name service
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken admin_user glance
				openstack-config --set /etc/glance/glance-registry.conf keystone_authtoken admin_password GLANCE_PASS
				openstack-config --set /etc/glance/glance-registry.conf paste_deploy flavor keystone
				
				keystone service-create --name=glance --type=image --description="OpenStack Image Service"
				keystone endpoint-create --service-id=$(keystone service-list | awk '/ image / {print $2}') --publicurl=http://openstack-i-cell-parent-1:9292 --internalurl=http://openstack-i-cell-parent-1:9292 --adminurl=http://openstack-i-cell-parent-1:9292
				
				service openstack-glance-api start
				service openstack-glance-registry start
				chkconfig openstack-glance-api on
				chkconfig openstack-glance-registry on
				
				mkdir images
				cd images/
				wget http://cdn.download.cirros-cloud.net/0.3.2/cirros-0.3.2-x86_64-disk.img
				glance image-create --name "cirros-0.3.2-x86_64" --disk-format qcow2 --container-format bare --is-public True --progress < cirros-0.3.2-x86_64-disk.img
				
				glance image-list
				
				バックアップ：20140710_nova_install_before
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-controller.html
				yum -y install openstack-nova-api openstack-nova-cert openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy python-novaclient openstack-nova-cells
				
				openstack-config --set /etc/nova/nova.conf database connection mysql://nova:NOVA_DBPASS@openstack-i-cell-parent-1/nova
				
				openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend qpid
				openstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack-i-cell-parent-1
				
				openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 192.168.10.61
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen 192.168.10.61
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 192.168.10.61
				
				mysql -u root -puser1
					CREATE DATABASE nova;
					GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
					GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
					exit;
				
				su -s /bin/sh -c "nova-manage db sync" nova
				
				keystone user-create --name=nova --pass=NOVA_PASS --email=nova@example.com
				keystone user-role-add --user=nova --tenant=service --role=admin
				
				openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_host openstack-i-cell-parent-1
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_user nova
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_password NOVA_PASS
				
				keystone service-create --name=nova --type=compute --description="OpenStack Compute"
				keystone endpoint-create --service-id=$(keystone service-list | awk '/ compute / {print $2}') --publicurl=http://openstack-i-cell-parent-1:8774/v2/%\(tenant_id\)s --internalurl=http://openstack-i-cell-parent-1:8774/v2/%\(tenant_id\)s --adminurl=http://openstack-i-cell-parent-1:8774/v2/%\(tenant_id\)s
				
				service openstack-nova-api start
				service openstack-nova-cert start
				service openstack-nova-consoleauth start
				service openstack-nova-conductor start
				service openstack-nova-novncproxy start
				service openstack-nova-cells start
				chkconfig openstack-nova-api on
				chkconfig openstack-nova-cert on
				chkconfig openstack-nova-consoleauth on
				chkconfig openstack-nova-conductor on
				chkconfig openstack-nova-novncproxy on
				chkconfig openstack-nova-cells on
				
				nova image-list
				
				バックアップ：20140710_nova_installed
				
		child-1-1
			os: centos 6.5 x86_64
			cpu: 2
			memory: 4 GB
			disk: 40 GB
			3nic:
				eth0: 192.168.116.62(nat)
				eth1: 192.168.10.62(bridge)
				eth2: 192.168.238.62(host only)
			install: dvd1
				root password: user1
				user: user1
				user password: user1
			setup:
				login root
				必要があればproxy設定
					vi /etc/yum.conf
						http_proxy=
				vi /etc/hosts
					#192.168.116.61 openstack-i-cell-parent-1
					192.168.10.61 openstack-i-cell-parent-1
					#192.168.238.61 openstack-i-cell-parent-1
					192.168.10.62 openstack-i-cell-child-1-1
					192.168.10.63 openstack-i-cell-child-1-2
				vi /etc/sysconfig/network
					NETWORKING=yes
					#HOSTNAME=localhost.localdomain
					HOSTNAME=openstack-i-cell-child-1-1
				vi /etc/sysconfig/network-scripts/ifcfg-eth0
					DEVICE="eth0"
					#BOOTPROTO="dhcp"
					BOOTPROTO="static"
					HWADDR="00:0C:29:BC:06:E5"
					IPV6INIT="yes"
					NM_CONTROLLED="yes"
					ONBOOT="yes"
					TYPE="Ethernet"
					UUID="7fce2f22-528c-4915-901e-4f90f014ecc4"
					IPADDR=192.168.116.62
					PREFIX=24
				vi /etc/sysconfig/network-scripts/ifcfg-eth1
					EVICE=eth1
					HWADDR=00:0C:29:BC:06:EF
					TYPE=Ethernet
					UUID=f4907d33-7c50-4cd0-90ca-e0a83d551a40
					ONBOOT=yes
					NM_CONTROLLED=yes
					#BOOTPROTO=dhcp
					BOOTPROTO=static
					IPADDR=192.168.10.62
					PREFIX=24
					GATEWAY=192.168.10.1
					DNS1=192.168.10.1
				vi /etc/sysconfig/network-scripts/ifcfg-eth2
					DEVICE=eth2
					HWADDR=00:0C:29:BC:06:F9
					TYPE=Ethernet
					UUID=ce1967ce-a970-4ce1-98d4-acd8cf617829
					ONBOOT=yes
					#NM_CONTROLLED=yes
					#BOOTPROTO=dhcp
					#BOOTPROTO=static
					BOOTPROTO=none
					#IPADDR=192.168.238.62
					#PREFIX=24
				
				setenforce 0
				getenforce
				vi /etc/selinux/config
					SELINUX=premissive
				
				reboot
				
				GUIでfirewallを解除
				
				バックアップ作成：20140625_os_installed
				
				service NetworkManager stop
				service network start
				chkconfig NetworkManager off
				chkconfig network on
				
				yum -y install ntp
				service ntpd start
				chkconfig ntpd on
				
				yum -y install mysql mysql-server MySQL-python
				vi /etc/my.cnf
					bind-address = 0.0.0.0
					default-storage-engine = innodb
					innodb_file_per_table
					collation-server = utf8_general_ci
					init-connect = 'SET NAMES utf8'
					character-set-server = utf8
				service mysqld start
				chkconfig mysqld on
				mysql_install_db
				mysql_secure_installation
					user1
				
				yum -y install MySQL-python
				
				yum -y install yum-plugin-priorities
				yum -y install http://repos.fedorapeople.org/repos/openstack/openstack-icehouse/rdo-release-icehouse-3.noarch.rpm
				yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
				yum -y install openstack-utils
				yum -y install openstack-selinux
				yum -y upgrade
				reboot
				
				yum -y install qpid-cpp-server
				vi /etc/qpidd.conf
					auth=no
				service qpidd start
				chkconfig qpidd on
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-controller.html
				yum -y install openstack-nova-cert openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler python-novaclient openstack-nova-cells
				
				openstack-config --set /etc/nova/nova.conf database connection mysql://nova:NOVA_DBPASS@openstack-i-cell-child-1-1/nova
				
				openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend qpid
				openstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack-i-cell-child-1-1
				
				openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 192.168.10.62
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen 192.168.10.62
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 192.168.10.62
				
				mysql -u root -puser1
					CREATE DATABASE nova;
					GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
					GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
					exit;
				
				su -s /bin/sh -c "nova-manage db sync" nova
				
				openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_host openstack-i-cell-parent-1
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_user nova
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_password NOVA_PASS
				
				service openstack-nova-cert start
				service openstack-nova-consoleauth start
				service openstack-nova-scheduler start
				service openstack-nova-conductor start
				service openstack-nova-novncproxy start
				service openstack-nova-cells start
				chkconfig openstack-nova-cert on
				chkconfig openstack-nova-consoleauth on
				chkconfig openstack-nova-scheduler on
				chkconfig openstack-nova-conductor on
				chkconfig openstack-nova-novncproxy on
				chkconfig openstack-nova-cells on
				
				nova image-list
				
				バックアップ：20140710_nova_installed
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-compute.html
				yum -y install openstack-nova-compute
				
				以下実施済み
					openstack-config --set /etc/nova/nova.conf database connection mysql://nova:NOVA_DBPASS@openstack-i-cell-child-1-1/nova
					openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_host openstack-i-cell-parent-1
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
					openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_user nova
					openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
					openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_password NOVA_PASS
					
					openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend qpid
					openstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack-i-cell-child-1-1
				
				openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 192.168.10.62
				openstack-config --set /etc/nova/nova.conf DEFAULT vnc_enabled True
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen 0.0.0.0
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 192.168.10.62
				openstack-config --set /etc/nova/nova.conf DEFAULT novncproxy_base_url http://openstack-i-cell-parent-1:6080/vnc_auto.html
				
				openstack-config --set /etc/nova/nova.conf DEFAULT glance_host openstack-i-cell-parent-1
				
				egrep -c '(vmx|svm)' /proc/cpuinfo
				
				#openstack-config --set /etc/nova/nova.conf libvirt virt_type qemu
				
				service libvirtd start
				service messagebus start
				service openstack-nova-compute start
				chkconfig libvirtd on
				chkconfig messagebus on
				chkconfig openstack-nova-compute on
				
				バックアップ：20140710_nova_installed
			
		child-1-2
			os: centos 6.5 x86_64
			cpu: 2
			memory: 4 GB
			disk: 40 GB
			3nic:
				eth0: 192.168.116.63(nat)
				eth1: 192.168.10.63(bridge)
				eth2: 192.168.238.63(host only)
			install: dvd1
				root password: user1
				user: user1
				user password: user1
			setup:
				login root
				必要があればproxy設定
					vi /etc/yum.conf
						http_proxy=
				vi /etc/hosts
					#192.168.116.61 openstack-i-cell-parent-1
					192.168.10.61 openstack-i-cell-parent-1
					#192.168.238.61 openstack-i-cell-parent-1
					192.168.10.62 openstack-i-cell-child-1-1
					192.168.10.63 openstack-i-cell-child-1-2
				vi /etc/sysconfig/network
					NETWORKING=yes
					#HOSTNAME=localhost.localdomain
					HOSTNAME=openstack-i-cell-child-1-2
				vi /etc/sysconfig/network-scripts/ifcfg-eth0
					DEVICE="eth0"
					#BOOTPROTO="dhcp"
					BOOTPROTO="static"
					HWADDR="00:0C:29:BC:06:E5"
					IPV6INIT="yes"
					NM_CONTROLLED="yes"
					ONBOOT="yes"
					TYPE="Ethernet"
					UUID="7fce2f22-528c-4915-901e-4f90f014ecc4"
					IPADDR=192.168.116.63
					PREFIX=24
				vi /etc/sysconfig/network-scripts/ifcfg-eth1
					EVICE=eth1
					HWADDR=00:0C:29:BC:06:EF
					TYPE=Ethernet
					UUID=f4907d33-7c50-4cd0-90ca-e0a83d551a40
					ONBOOT=yes
					NM_CONTROLLED=yes
					#BOOTPROTO=dhcp
					BOOTPROTO=static
					IPADDR=192.168.10.63
					PREFIX=24
					GATEWAY=192.168.10.1
					DNS1=192.168.10.1
				vi /etc/sysconfig/network-scripts/ifcfg-eth2
					DEVICE=eth2
					HWADDR=00:0C:29:BC:06:F9
					TYPE=Ethernet
					UUID=ce1967ce-a970-4ce1-98d4-acd8cf617829
					ONBOOT=yes
					#NM_CONTROLLED=yes
					#BOOTPROTO=dhcp
					#BOOTPROTO=static
					BOOTPROTO=none
					#IPADDR=192.168.238.63
					#PREFIX=24
				
				setenforce 0
				getenforce
				vi /etc/selinux/config
					SELINUX=premissive
				
				GUIでfirewallを解除
				
				reboot
				
				バックアップ作成：20140625_os_installed
				
				service NetworkManager stop
				service network start
				chkconfig NetworkManager off
				chkconfig network on
				
				yum -y install ntp
				service ntpd start
				chkconfig ntpd on
				
				yum -y install mysql mysql-server MySQL-python
				vi /etc/my.cnf
					bind-address = 0.0.0.0
					default-storage-engine = innodb
					innodb_file_per_table
					collation-server = utf8_general_ci
					init-connect = 'SET NAMES utf8'
					character-set-server = utf8
				service mysqld start
				chkconfig mysqld on
				mysql_install_db
				mysql_secure_installation
					user1
				
				yum -y install MySQL-python
				
				yum -y install yum-plugin-priorities
				yum -y install http://repos.fedorapeople.org/repos/openstack/openstack-icehouse/rdo-release-icehouse-3.noarch.rpm
				yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
				yum -y install openstack-utils
				yum -y install openstack-selinux
				yum -y upgrade
				reboot
				
				yum -y install qpid-cpp-server
				vi /etc/qpidd.conf
					auth=no
				service qpidd start
				chkconfig qpidd on
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-controller.html
				yum -y install openstack-nova-cert openstack-nova-conductor openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler python-novaclient openstack-nova-cells
				
				openstack-config --set /etc/nova/nova.conf database connection mysql://nova:NOVA_DBPASS@openstack-i-cell-child-1-2/nova
				
				openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend qpid
				openstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack-i-cell-child-1-2
				
				openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 192.168.10.63
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen 192.168.10.63
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 192.168.10.63
				
				mysql -u root -puser1
					CREATE DATABASE nova;
					GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'NOVA_DBPASS';
					GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'NOVA_DBPASS';
					exit;
				
				su -s /bin/sh -c "nova-manage db sync" nova
				
				openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_host openstack-i-cell-parent-1
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
				openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_user nova
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
				openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_password NOVA_PASS
				
				service openstack-nova-cert start
				service openstack-nova-consoleauth start
				service openstack-nova-scheduler start
				service openstack-nova-conductor start
				service openstack-nova-novncproxy start
				service openstack-nova-cells start
				chkconfig openstack-nova-cert on
				chkconfig openstack-nova-consoleauth on
				chkconfig openstack-nova-scheduler on
				chkconfig openstack-nova-conductor on
				chkconfig openstack-nova-novncproxy on
				chkconfig openstack-nova-cells on
				
				nova image-list
				
				バックアップ：20140710_nova_installed
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-compute.html
				yum -y install openstack-nova-compute
				
				以下実施済み
					openstack-config --set /etc/nova/nova.conf database connection mysql://nova:NOVA_DBPASS@openstack-i-cell-child-1-2/nova
					openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://openstack-i-cell-parent-1:5000
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_host openstack-i-cell-parent-1
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_protocol http
					openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_port 35357
					openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_user nova
					openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service
					openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_password NOVA_PASS
					
					openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend qpid
					openstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack-i-cell-child-1-2
				
				openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 192.168.10.63
				openstack-config --set /etc/nova/nova.conf DEFAULT vnc_enabled True
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen 0.0.0.0
				openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address 192.168.10.63
				openstack-config --set /etc/nova/nova.conf DEFAULT novncproxy_base_url http://openstack-i-cell-parent-1:6080/vnc_auto.html
				
				openstack-config --set /etc/nova/nova.conf DEFAULT glance_host openstack-i-cell-parent-1
				
				egrep -c '(vmx|svm)' /proc/cpuinfo
				
				#openstack-config --set /etc/nova/nova.conf libvirt virt_type qemu
				
				service libvirtd start
				service messagebus start
				service openstack-nova-compute start
				chkconfig libvirtd on
				chkconfig messagebus on
				chkconfig openstack-nova-compute on
				
				バックアップ：20140710_nova_installed
			
	cells
		http://docs.openstack.org/icehouse/config-reference/content/section_compute-cells.html
			
		parent-1
			vi /etc/nova/nova.conf
				[DEFAULT]
				compute_api_class=nova.compute.cells_api.ComputeCellsAPI
				...(略)
				[cells]
				enable=True
				name=api
				capabilities=hypervisor=kvm,os=linux
				cell_type=api
			
			service openstack-nova-cells restart
			
			nova-manage cell create --name=child-1 --cell_type=child --hostname=192.168.10.62 --port=5672 --woffset=1.0 --wscale=1.0
			nova-manage cell create --name=child-2 --cell_type=child --hostname=192.168.10.63 --port=5672 --woffset=1.0 --wscale=1.0
			
			nova-manage cell list
			
			service openstack-nova-cells restart
			
		child-1-1
			vi /etc/nova/nova.conf
				[DEFAULT]
				quota_driver=nova.quota.NoopQuotaDriver
				...(略)
				[cells]
				enable=True
				name=name=child-1
				capabilities=hypervisor=kvm,os=linux
			
			service openstack-nova-cells restart
			
			nova-manage cell create --name=api --cell_type=parent --hostname=192.168.10.61 --port=5672 --woffset=1.0 --wscale=1.0
			
			nova-manage cell list
			
			service openstack-nova-cells restart
			
		child-1-2
			vi /etc/nova/nova.conf
				[DEFAULT]
				quota_driver=nova.quota.NoopQuotaDriver
				...(略)
				[cells]
				enable=True
				name=name=child-2
				capabilities=hypervisor=kvm,os=linux
			
			service openstack-nova-cells restart
			
			nova-manage cell create --name=api --cell_type=parent --hostname=192.168.10.61 --port=5672 --woffset=1.0 --wscale=1.0
			
			nova-manage cell list
			
			service openstack-nova-cells restart
			
		parent-1
			nova cell-capacities
				Ram Available: 3313 MB
				+---------+-------+
				| Ram(MB) | Units |
				+---------+-------+
				| 16384   | 0     |
				| 2048    | 1     |
				| 4096    | 0     |
				| 512     | 5     |
				| 8192    | 0     |
				+---------+-------+

				Disk Available: 35840 MB
				+----------+-------+
				| Disk(MB) | Units |
				+----------+-------+
				| 1024     | 31    |
				| 163840   | 0     |
				| 20480    | 1     |
				| 40960    | 0     |
				| 81920    | 0     |
				+----------+-------+
			
			nova cell-show child-1
				エラーとなった。以下に関係？
					https://bugs.launchpad.net/nova/+bug/1312002
			
			nova cell-show child-2
			
		parent-1
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-networking-controller-node.html
				
				openstack-config --set /etc/nova/nova.conf DEFAULT network_api_class nova.network.api.API
				openstack-config --set /etc/nova/nova.conf DEFAULT security_group_api nova
				
				service openstack-nova-api restart
				service openstack-nova-conductor restart
				
		child-1-1 and child-1-2
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-networking-controller-node.html
				
				openstack-config --set /etc/nova/nova.conf DEFAULT network_api_class nova.network.api.API
				openstack-config --set /etc/nova/nova.conf DEFAULT security_group_api nova
				
				service openstack-nova-api restart
				service openstack-nova-conductor restart
				
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-networking-compute-node.html
				
				yum -y install openstack-nova-network openstack-nova-api
				
				openstack-config --set /etc/nova/nova.conf DEFAULT network_api_class nova.network.api.API
				openstack-config --set /etc/nova/nova.conf DEFAULT security_group_api nova
				openstack-config --set /etc/nova/nova.conf DEFAULT network_manager nova.network.manager.FlatDHCPManager
				openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.libvirt.firewall.IptablesFirewallDriver
				openstack-config --set /etc/nova/nova.conf DEFAULT network_size 254
				openstack-config --set /etc/nova/nova.conf DEFAULT allow_same_net_traffic False
				openstack-config --set /etc/nova/nova.conf DEFAULT multi_host True
				openstack-config --set /etc/nova/nova.conf DEFAULT send_arp_for_ha True
				openstack-config --set /etc/nova/nova.conf DEFAULT share_dhcp_address True
				openstack-config --set /etc/nova/nova.conf DEFAULT force_dhcp_release True
				openstack-config --set /etc/nova/nova.conf DEFAULT flat_network_bridge br100
				openstack-config --set /etc/nova/nova.conf DEFAULT flat_interface eth2
				openstack-config --set /etc/nova/nova.conf DEFAULT public_interface eth1
				
				service openstack-nova-network start
				service openstack-nova-metadata-api start
				chkconfig openstack-nova-network on
				chkconfig openstack-nova-metadata-api on
				
				reboot
				
		parent-1
			reboot
			
		child-1-1
			reboot
			
		child-1-1
			reboot
			
		parent-1
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/nova-network-initial-network.html
				
				source admin-openrc.sh
				
				nova network-create demo-net --bridge br100 --multi-host T --fixed-range-v4 192.168.238.24/29
					エラーとなる。各child cellでnova-manage network createを実行する
					本来は、parentでnova-network(neutronは?)を稼働させるべき?な感じ。後でやり直し。
						https://etherpad.openstack.org/p/FolsomComputeCells
							Will networking work across cell boundaries transparently?
							A: There's probably some work for network and volumes to tie this in right now. We don't know use cases yet. Nova-network needs to run on the API cell, but this is really just for the network API extensin.
						http://comstud.com/GrizzlyCells.pdf
							P6では、各子cellにnova-networkが存在しているが。。。
				
		child-1
			nova-manage network create --label demo-net --fixed_range_v4=192.168.238.24/29 --bridge=br100 --bridge_interface=eth2 --multi_host=T
			nova-manage network list
				id      IPv4                    IPv6            start address   DNS1            DNS2            VlanID          project         uuid
				1       192.168.238.24/29       None            192.168.238.26  8.8.4.4         None            None            None            8c4594c2-f0d5-492c-9481-3455fc9c2384
				
		child-2
			nova-manage network create --label demo-net --fixed_range_v4=192.168.238.24/29 --bridge=br100 --bridge_interface=eth2 --multi_host=T
			nova-manage network list
				id      IPv4                    IPv6            start address   DNS1            DNS2            VlanID          project         uuid
				1       192.168.238.24/29       None            192.168.238.26  8.8.4.4         None            None            None            ef0e69b4-bf9b-4ed4-a92e-3f0e546190a2
				
		parent-1
			http://docs.openstack.org/icehouse/install-guide/install/yum/content/launch-instance-nova.html
				nova service list
					+------------------+----------------------------------------+----------+---------+-------+----------------------------+-----------------+
					| Binary           | Host                                   | Zone     | Status  | State | Updated_at                 | Disabled Reason |
					+------------------+----------------------------------------+----------+---------+-------+----------------------------+-----------------+
					| nova-consoleauth | api!child-2@openstack-i-cell-child-1-2 | internal | enabled | up    | 2014-07-21T12:04:01.000000 | -               |
					| nova-scheduler   | api!child-2@openstack-i-cell-child-1-2 | internal | enabled | up    | 2014-07-21T12:04:01.000000 | -               |
					| nova-cert        | api!child-2@openstack-i-cell-child-1-2 | internal | enabled | up    | 2014-07-21T12:04:01.000000 | -               |
					| nova-conductor   | api!child-2@openstack-i-cell-child-1-2 | internal | enabled | up    | 2014-07-21T12:04:01.000000 | -               |
					| nova-compute     | api!child-2@openstack-i-cell-child-1-2 | nova     | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-cells       | api!child-2@openstack-i-cell-child-1-2 | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-network     | api!child-2@openstack-i-cell-child-1-2 | internal | enabled | up    | 2014-07-21T12:04:05.000000 | -               |
					| nova-consoleauth | api!child-1@openstack-i-cell-child-1-1 | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-conductor   | api!child-1@openstack-i-cell-child-1-1 | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-cert        | api!child-1@openstack-i-cell-child-1-1 | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-scheduler   | api!child-1@openstack-i-cell-child-1-1 | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-cells       | api!child-1@openstack-i-cell-child-1-1 | internal | enabled | up    | 2014-07-21T12:04:04.000000 | -               |
					| nova-compute     | api!child-1@openstack-i-cell-child-1-1 | nova     | enabled | up    | 2014-07-21T12:04:09.000000 | -               |
					| nova-network     | api!child-1@openstack-i-cell-child-1-1 | internal | enabled | up    | 2014-07-21T12:04:02.000000 | -               |
					| nova-conductor   | api@openstack-i-cell-parent-1          | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-consoleauth | api@openstack-i-cell-parent-1          | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-cert        | api@openstack-i-cell-parent-1          | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					| nova-cells       | api@openstack-i-cell-parent-1          | internal | enabled | up    | 2014-07-21T12:04:03.000000 | -               |
					+------------------+----------------------------------------+----------+---------+-------+----------------------------+-----------------+
					TODO api側はcells以外不要かも
				
				source demo-openrc.sh
				
				nova flavor-list
				
				nova image-list
				
				nova net-list
				
				nova secgroup-list
				
				nova hypervisor-list
					+---------------+----------------------------+
					| ID            | Hypervisor hostname        |
					+---------------+----------------------------+
					| api!child-2@1 | openstack-i-cell-child-1-2 |
					| api!child-1@1 | openstack-i-cell-child-1-1 |
					+---------------+----------------------------+
				
				nova boot --flavor m1.tiny --image cirros-0.3.2-x86_64 --security-group default demo-instance1
					ここでネットワーク未作成、プロジェクトに未割当だと、NICは作成されずに作成される。
					ネットワーク作成済み、プロジェクト割り当て済み(デフォルト空きネットワークを取得？だったかな)
				
				nova boot --flavor m1.tiny --image cirros-0.3.2-x86_64 --nic net-id=8c4594c2-f0d5-492c-9481-3455fc9c2384 --security-group default demo-instance1
					zone指定でcell内のノード指定は可能?現状やり方が不明だし、ホスト指定だとうまくいかない。
						nova boot --flavor m1.tiny --image cirros-0.3.2-x86_64 --security-group default --availability-zone nova:openstack-i-cell-child-1-1 demo-instance1
						nova boot --flavor m1.tiny --image cirros-0.3.2-x86_64 --security-group default --availability-zone nova:openstack-i-cell-child-1-2 demo-instance1
						
						nova boot --flavor m1.tiny --image cirros-0.3.2-x86_64 --nic net-id=8c4594c2-f0d5-492c-9481-3455fc9c2384 --security-group default --availability-zone nova:openstack-i-cell-child-1-1 demo-instance1
						nova boot --flavor m1.tiny --image cirros-0.3.2-x86_64 --nic net-id=ef0e69b4-bf9b-4ed4-a92e-3f0e546190a2 --security-group default --availability-zone nova:openstack-i-cell-child-1-2 demo-instance1
				
				子セル側にうまく設定できない気がする。
				nova get-vnc-console demo-instance1 novnc
				
				nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0
				
				nova secgroup-add-rule default tcp 1 65535 0.0.0.0/0
				
				nova secgroup-add-rule default udp 1 65535 0.0.0.0/0
				
				compute nodeからインスタンスにping/sshが接続できることを確認。
				
